# GitHub Actions - CI/CD Pipeline

## Описание
Простой и эффективный CI/CD pipeline для Laravel приложения с автоматическим тестированием, проверкой качества кода и деплоем.

## Workflows

### 1. CI Pipeline (`ci.yml`)
**Триггеры:** Push в `main`/`develop`, Pull Request в `main`

**Выполняет:**
- ✅ Установку зависимостей (PHP + Node.js)
- ✅ Запуск тестов (Unit + Feature)
- ✅ Проверку стиля кода (Laravel Pint)
- ✅ Сборку фронтенд ассетов
- ✅ Загрузку отчетов о покрытии кода

### 2. Code Quality (`code-quality.yml`)
**Триггеры:** Push в `main`/`develop`, Pull Request в `main`

**Выполняет:**
- ✅ Проверку стиля кода (Laravel Pint)
- ✅ Проверку уязвимостей (Composer Audit)
- ✅ Проверку устаревших зависимостей

### 3. API Tests (`api-tests.yml`)
**Триггеры:** Push в `main`/`develop`, Pull Request в `main`

**Выполняет:**
- ✅ Тестирование API endpoints
- ✅ Тестирование Filament компонентов
- ✅ Создание тестовых данных
- ✅ Загрузку результатов тестов

### 4. Deploy (`deploy.yml`)
**Триггеры:** Push в `main`, ручной запуск

**Выполняет:**
- ✅ Создание бэкапа перед деплоем
- ✅ Обновление кода с сервера
- ✅ Установку зависимостей
- ✅ Выполнение миграций БД
- ✅ Кэширование конфигурации
- ✅ Сборку фронтенд ассетов
- ✅ Настройку прав доступа
- ✅ Перезапуск сервисов
- ✅ Проверку работоспособности

### 5. Auto Format (`auto-format.yml`)
**Триггеры:** Pull Request в `main` (только PHP файлы)

**Выполняет:**
- ✅ Автоматическое форматирование кода
- ✅ Коммит исправлений

## Настройка Secrets

### Обязательные секреты для деплоя:
- `HOST` - IP адрес сервера
- `USERNAME` - SSH пользователь
- `SSH_KEY` - Приватный SSH ключ
- `PORT` - SSH порт (по умолчанию 22)

### Настройка:
1. GitHub → Settings → Secrets and variables → Actions
2. Добавьте каждый секрет с соответствующим именем

## Локальная разработка

### Запуск проверок качества кода:
```bash
# Проверка стиля кода
composer run quality

# Автоматическое исправление
composer run quality:fix

# Запуск тестов
composer run test
```

### Установка зависимостей для разработки:
```bash
composer install
npm install
```

## Структура папок на сервере

```
/var/www/sklad/          # Основная папка проекта
/var/backups/sklad/      # Папка для бэкапов
```

## Безопасность

- ✅ SSH ключи настроены через GitHub Secrets
- ✅ Автоматическое создание бэкапов перед деплоем
- ✅ Проверка работоспособности после деплоя
- ✅ Откат при ошибках деплоя
