name: Clear Cache Only

on:
  workflow_dispatch: # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº
    inputs:
      cache_type:
        description: 'Type of cache to clear'
        required: false
        default: 'all'
        type: choice
        options:
        - all
        - config
        - routes
        - views
        - application
        - events
        - queues

jobs:
  clear-cache:
    runs-on: ubuntu-latest
    
    steps:
    - name: Clear cache on server
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        port: ${{ secrets.PORT }}
        script_stop: true
        debug: true
        script: |
          echo "ğŸ§¹ Starting cache clearing..."
          echo "ğŸ“ Current directory: $(pwd)"
          echo "ğŸ‘¤ Current user: $(whoami)"
          
          cd /var/www/sklad
          echo "ğŸ“‚ Changed to /var/www/sklad"
          
          case "${{ github.event.inputs.cache_type }}" in
            "all")
              echo "ğŸ§¹ Clearing all caches..."
              php artisan config:clear
              php artisan route:clear
              php artisan view:clear
              php artisan cache:clear
              php artisan event:clear
              php artisan queue:clear
              echo "âœ… All caches cleared"
              ;;
            "config")
              echo "âš™ï¸ Clearing config cache..."
              php artisan config:clear
              echo "âœ… Config cache cleared"
              ;;
            "routes")
              echo "ğŸ›£ï¸ Clearing route cache..."
              php artisan route:clear
              echo "âœ… Route cache cleared"
              ;;
            "views")
              echo "ğŸ‘ï¸ Clearing view cache..."
              php artisan view:clear
              echo "âœ… View cache cleared"
              ;;
            "application")
              echo "ğŸ“± Clearing application cache..."
              php artisan cache:clear
              echo "âœ… Application cache cleared"
              ;;
            "events")
              echo "ğŸ“¡ Clearing event cache..."
              php artisan event:clear
              echo "âœ… Event cache cleared"
              ;;
            "queues")
              echo "ğŸ“‹ Clearing queue cache..."
              php artisan queue:clear
              echo "âœ… Queue cache cleared"
              ;;
          esac
          
          echo "ğŸ”„ Reloading services..."
          sudo systemctl reload php8.4-fpm
          sudo systemctl reload nginx
          
          echo "âœ… Cache clearing completed successfully!"
