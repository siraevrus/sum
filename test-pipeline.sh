#!/bin/bash

# üß™ –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è CI/CD Pipeline
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./test-pipeline.sh

set -e

echo "üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CI/CD Pipeline"
echo "================================"

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ç–∞—Ç—É—Å–∞
print_status() {
    if [ $1 -eq 0 ]; then
        echo -e "${GREEN}‚úÖ $2${NC}"
    else
        echo -e "${RED}‚ùå $2${NC}"
        exit 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
print_warning() {
    echo -e "${YELLOW}‚ö†Ô∏è $1${NC}"
}

echo ""
echo "1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞..."
composer run quality
print_status $? "–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ"

echo ""
echo "2. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
composer run test || print_warning "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)"

echo ""
echo "3. –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞..."
npm run build
print_status $? "–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–±—Ä–∞–Ω"

echo ""
echo "4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
composer outdated --direct || print_warning "–ï—Å—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"

echo ""
echo "5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏..."
composer audit || print_warning "–ù–∞–π–¥–µ–Ω—ã —É—è–∑–≤–∏–º–æ—Å—Ç–∏"

echo ""
echo "6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ PHP..."
find app -name "*.php" -exec php -l {} \; > /dev/null
print_status $? "–°–∏–Ω—Ç–∞–∫—Å–∏—Å PHP –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω"

echo ""
echo "7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
php artisan config:cache
php artisan config:clear
print_status $? "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Laravel –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞"

echo ""
echo "8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤..."
php artisan route:list > /dev/null
print_status $? "–ú–∞—Ä—à—Ä—É—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"

echo ""
echo "================================"
echo -e "${GREEN}üéâ Pipeline —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!${NC}"
echo ""
echo "üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:"
echo "‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ - OK"
echo "‚úÖ –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ - OK"
echo "‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å PHP - OK"
echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Laravel - OK"
echo "‚úÖ –ú–∞—Ä—à—Ä—É—Ç—ã - OK"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GitHub Actions: https://github.com/your-repo/actions"
echo "2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è –¥–µ–ø–ª–æ—è"
echo "3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –¥–µ–ø–ª–æ–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤–µ—Ç–∫–µ"
echo ""
echo "üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
echo "- PIPELINE_GUIDE.md - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ"
echo "- TESTING_GUIDE.md - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é"
echo "- QUICK_START.md - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç"
